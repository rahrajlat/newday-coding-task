version: 2

sources:
  - name: marts
    description: "Reporting Tables that are exposed for Analytics"
    database: dbt_db
    schema: marts
    loader: "postgres"

    tables:
      - name: mart_customer_segmentation
        description: "This table holds the customer segmentation information based on their purchase history"
        columns:
          - name: customer_id
            description: "Unique Identifier for the Customer Record"
            tests: [not_null, unique]
          - name: customer_name
            description: "Name of the Customer"
            tests: [not_null]
          - name: total_orders
            description: "Orders Placed by the customer"
            tests: [not_null]
          - name: total_purchase_amount
            description: "Total Purchase Amount"
            tests: [not_null]
          - name: customer_tiers
            description: "Customer Segmentation"
            tests:
              - accepted_values:
                  values: ["Low Value", "Medium Values", "High Value"]

      - name: mart_daily_sales_macro_model
        description: "This table holds the Revenue generated on the given date range"
        columns:
          - name: order_date
            description: "Date on which the Order is Aggregated"
            tests: [not_null, unique]
          - name: total_revenue_by_orders_amount
            description: "This is Aggregated purely based on the Order Amount excluding discounts & shipments"
            tests: [not_null]
          - name: total_revenue_by_excluding_shipping
            description: "This is Aggregated based on the Order Amount excluding shipments"
            tests: [not_null]
          - name: total_revenue_by_including_shipping
            description: "This is Aggregated purely based on the Order Amount including shipments and discounts"
            tests: [not_null]

      - name: mart_flag_customer_orders
        description: "This table flags the transaction if the Discount > 30% or Shipping cost > 10%"
        columns:
          - name: order_id
            description: "Unique Idenfier for an Order"
            tests: [not_null, unique]
          - name: discount_applied
            description: "Applied Discount"
            tests: [not_null]
          - name: shipping_cost
            description: "Cost of the Shipping"
            tests: [not_null]
          - name: order_amount
            description: "order value of the transaction"
            tests: [not_null]
          - name: flagged_transaction
            description: "Flag for identifying fraud transactions"
            tests:
              - accepted_values:
                  values: ["Y", "N"]

      - name: mart_payment_method_metrics
        description: "This table has payment related metrics"
        columns:
          - name: payment_method
            description: "Types of Payment methods"
            tests:
              - accepted_values:
                  values: ["bank_transfer", "debit_card","credit_card","paypal"]
          - name: total_revenue_by_orders_amount
            description: "Total Revenue just based on the Orders Amount"
            tests: [not_null]
          - name: total_revenue_by_excluding_shipping
            description: "Total Revenue just based on the Orders Amount , excluding shipping"
            tests: [not_null]
          - name: total_revenue_by_including_shipping
            description: "Total Revenue just based on the Orders Amount , including shipping"
            tests: [not_null]
          - name: avg_order_value
            description: "Average Order Value by payment_method"
            tests: [not_null]
          - name: num_of_orders
            description: "Total Number of Orders Per payment category"
            tests: [not_null]

      - name: mart_sales_payment_method_monthly
        description: "Sales per payment method"
        columns:
          - name: category_name
            description: "Types of Product Categories"
            tests:
              - accepted_values:
                  values: ["Sports", "Electronics","Home & Garden","Clothing","Books"]
          - name: month_start
            description: "Monthly Date"
            tests: [not_null]
          - name: payment_method
            description: "Types of Payment methods"
            tests:
              - accepted_values:
                  values: ["bank_transfer", "debit_card","credit_card","paypal"]
          - name: revenue_method_pct_only_order_amount
            description: "Total Revenue just based on the Orders Amount , including shipping"
            tests: [not_null]
          
          - name: revenue_payment_method_pct_excluding_shipping
            description: "Total Revenue just based on the Orders Amount , excluding shipping"
            tests: [not_null]

          - name: revenue_payment_method_pct_including_shipping
            description: "Total Revenue just based on the Orders Amount , including shipping"
            tests: [not_null]


      - name: mart_sales_revenue_product_category_monthly
        description: "Sales Per Category"
        columns:
          - name: category_name
            description: "Types of Product Categories"
            tests:
              - accepted_values:
                  values: ["Sports", "Electronics","Home & Garden","Clothing","Books"]
          - name: monthly_date
            description: "Monthly Date"
            tests: [not_null]
          - name: total_revenue_orders
            description: "Total Revenue just based on the Orders Amount , including shipping"
            tests: [not_null]
          
          - name: net_revenue_excl_shipping
            description: "Total Revenue just based on the Orders Amount , excluding shipping"
            tests: [not_null]

          - name: net_revenue_incl_shipping
            description: "Total Revenue just based on the Orders Amount , including shipping"
            tests: [not_null]
      
      - name: mart_seasonal_sales_patterns_monthly
        description: "Seasonal Sales Patterns"
        columns:
          - name: category_name
            description: "Types of Product Categories"
            tests:
              - accepted_values:
                  values: ["Sports", "Electronics","Home & Garden","Clothing","Books"]
          - name: monthly_date
            description: "Monthly Date"
            tests: [not_null]
          - name: revenue
            description: "Total Revenue just based on the Orders Amount , including shipping"
            tests: [not_null]
          
          - name: best_worst_month
            description: "Flag to know which is the best/worst month"
            tests:
              - accepted_values:
                  values: ["BEST", "WORST","NULL"]

      - name: mart_seasonal_sales_patterns_quarterly
        description: "Seasonal Sales Patterns"
        columns:
          - name: year_no
            description: "Year"
            tests: [not_null]

          - name: category_name
            description: "Types of Product Categories"
            tests:
              - accepted_values:
                  values: ["Sports", "Electronics","Home & Garden","Clothing","Books"]

          - name: quarter_number
            description: "Year"
            tests: [not_null]
